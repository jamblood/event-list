(()=>{"use strict";document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".accept-event, .decline-event").forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault();const n=e.dataset.eventId,o=e.classList.contains("decline-event");let d="";if(o)try{if(d=await new Promise((e=>{const t=document.createElement("div");t.className="future-events-modal",t.innerHTML='\n            <div class="modal-backdrop fixed inset-0 bg-black bg-opacity-50"></div>\n            <div class="modal-content fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-lg w-[95%] max-w-md">\n                <h2 class="text-xl font-bold mb-4">Reason for Declining</h2>\n                <textarea \n                    id="decline-reason-input" \n                    class="w-full p-2 border rounded mb-4 h-32 resize-none" \n                    placeholder="Please specify your reason..."\n                    required\n                ></textarea>\n                <div class="flex justify-end gap-2">\n                    <button \n                        id="modal-cancel" \n                        class="px-4 py-2 border rounded hover:bg-gray-50"\n                    >\n                        Cancel\n                    </button>\n                    <button \n                        id="modal-confirm" \n                        class="px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600 disabled:bg-gray-300 disabled:cursor-not-allowed"\n                        disabled\n                    >\n                        Really Decline\n                    </button>\n                </div>\n            </div>\n        ',document.body.appendChild(t),document.body.classList.add("overflow-hidden");const n=t.querySelector("#decline-reason-input"),o=t.querySelector("#modal-confirm"),d=t.querySelector("#modal-cancel"),a=t.querySelector(".modal-backdrop"),c=()=>{o.disabled=!n.value.trim()},r=()=>{l(),e(n.value.trim())},s=()=>{l(),e(null)},l=()=>{document.body.removeChild(t),document.body.classList.remove("overflow-hidden"),n.removeEventListener("input",c),o.removeEventListener("click",r),d.removeEventListener("click",s),a.removeEventListener("click",s),document.removeEventListener("keydown",i)},i=e=>{"Enter"!==e.key||o.disabled||r(),"Escape"===e.key&&s()};n.addEventListener("input",c),o.addEventListener("click",r),d.addEventListener("click",s),a.addEventListener("click",s),document.addEventListener("keydown",i),setTimeout((()=>n.focus()),50)})),!d)return}catch(e){return void console.error("Modal error:",e)}const a=o?"decline":"accept";console.log(`Processing ${a} for event:`,n);try{const t=await fetch(ajax_object.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"handle_event_registration",event_id:n,status:a,custom_reason:d,security:ajax_object.nonce})}),o=await t.json();if(console.log("AJAX Response:",o),o.success){e.disabled=!0,e.textContent="accept"===a?"Accepted":"Declined (Reason: "+d.substring(0,15)+"...)";const t=e.closest(".event-item").querySelector(".status-message");t&&t.remove();const n=document.createElement("div");n.className="status-message text-sm mt-1",n.textContent=`Status updated: ${a}`,e.insertAdjacentElement("afterend",n)}}catch(e){console.error("AJAX Error:",e),alert("Error processing your request. Please try again.")}}))}))})),document.querySelectorAll("[disabled].accept-event, [disabled].decline-event").forEach((e=>{(e.textContent.includes("Accepted")||e.textContent.includes("Declined"))&&(e.disabled=!0)}))})();